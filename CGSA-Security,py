mport cv2
import time
import threading

class SistemaSeguridadCajero:
    def __init__(self, camaras):
        self.camaras = camaras
        self.grabacion_activa = False
        self.alarma_activada = False
    
    def iniciar_camaras(self):
        """Inicia la transmisi贸n de c谩maras y ejecuta la evaluaci贸n de riesgos en tiempo real."""
        for camara in self.camaras:
            threading.Thread(target=self.monitorear_camara, args=(camara,)).start()
    
    def monitorear_camara(self, camara_url):
        """Analiza video en tiempo real en busca de comportamientos sospechosos y eval煤a el nivel de riesgo."""
        cap = cv2.VideoCapture(camara_url)
        
        while True:
            ret, frame = cap.read()
            if not ret:
                print(f"Error al conectar con la c谩mara {camara_url}")
                break
            
            # Procesamiento de video para detecci贸n y evaluaci贸n de riesgos (CGSA-Security)
            movimiento_sospechoso = self.detectar_movimiento(frame)
            obstruccion = self.detectar_obstruccion(frame)
            manipulacion = self.detectar_manipulacion(frame)
            
            # Evaluaci贸n del riesgo basado en el evento detectado (CGSA-Security)
            riesgo = self.evaluar_riesgo(movimiento_sospechoso, obstruccion, manipulacion)
            
            # Responder seg煤n el nivel de riesgo (CGSA-Security)
            if riesgo == "ALTO":
                self.activar_alarma()
                self.grabar_video(frame)
                self.enviar_alerta_seguridad()
            elif riesgo == "MEDIO":
                self.grabar_video(frame)
            elif riesgo == "BAJO":
                print("Actividad monitoreada, sin riesgo significativo.")
    
    def detectar_movimiento(self, frame):
        """Detecta movimiento an贸malo mediante an谩lisis de video en tiempo real."""
        movimiento_detectado = False
        # L贸gica de detecci贸n de movimiento inusual, podr铆a basarse en IA para HCSA-CCTV
        return movimiento_detectado

    def detectar_obstruccion(self, frame):
        """Detecta si la c谩mara ha sido obstruida."""
        obstruccion_detectada = False
        # Implementaci贸n de detecci贸n de obstrucci贸n, crucial para monitoreo CCTV (HCSA-CCTV)
        return obstruccion_detectada

    def detectar_manipulacion(self, frame):
        """Detecta intentos de manipulaci贸n indebida en el cajero."""
        manipulacion_detectada = False
        # Detecci贸n de manipulaci贸n a trav茅s de visi贸n por computadora, aplicando HCSA-CCTV
        return manipulacion_detectada

    def evaluar_riesgo(self, movimiento_sospechoso, obstruccion, manipulacion):
        """Eval煤a el nivel de riesgo de un evento, aplicando habilidades CGSA-Security."""
        if manipulacion or obstruccion:
            return "ALTO"
        elif movimiento_sospechoso:
            return "MEDIO"
        else:
            return "BAJO"
    
    def activar_alarma(self):
        """Activa la alarma sonora y visual para incidentes de riesgo alto."""
        if not self.alarma_activada:
            print("锔 Alarma activada: posible robo en curso 锔")
            self.alarma_activada = True
            # Integrar hardware para activar sirena o luces de alerta (CGSA-Security)

    def grabar_video(self, frame):
        """Inicia o contin煤a la grabaci贸n del video del evento."""
        if not self.grabacion_activa:
            self.grabacion_activa = True
            print("Grabaci贸n iniciada para evidencia del incidente.")
            # C贸digo para grabar video o transmitir a un servidor para HCSA-CCTV

    def enviar_alerta_seguridad(self):
        """Env铆a alertas autom谩ticas al equipo de seguridad y a la polic铆a (CGSA-Security)."""
        print(" Contactando a seguridad y polic铆a ")
        # Enviar mensajes autom谩ticos o hacer una llamada al n煤mero de emergencia
        # Adem谩s, enviar video en tiempo real a seguridad en dispositivos m贸viles

# Ejemplo de URLs de c谩maras IP (configuraci贸n para vigilancia CCTV, HCSA-CCTV)
camaras_ip = [
    "http://192.168.1.10:8080/video",
    "http://192.168.1.11:8080/video",
    "http://192.168.1.12:8080/video",
    "http://192.168.1.13:8080/video"
]

# Inicializar el sistema de seguridad
sistema_seguridad = SistemaSeguridadCajero(camaras_ip)
sistema_seguridad.iniciar_camaras()
